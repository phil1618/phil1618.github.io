<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Cookie Consent PostMessage Test</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 1rem;
        }

        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ccc;
        }

        button {
            margin-right: 0.5rem;
        }
    </style>
</head>

<body>
    <h1>PostMessage Test Host</h1>
    <p>This page simulates as the event embedding.</p>
    <div>
        <button onclick="sendConsent(true)">Send consent = true</button>
        <button onclick="sendConsent(false)">Send consent = false</button>
    </div>
    <div style="height:0;padding-bottom:56.250%;position:relative;"><iframe
            id="test-iframe"
            src="https://studio.flowr.dev/portal/event/embed/en/27836" width="100%" height="100%"
            style="border:0;left:0;position:absolute;top:0;" frameborder="0" scrolling="yes" allowfullscreen></iframe>
    </div>
    <script>
        const iframe = document.getElementById("test-iframe");

        function sendConsent(value) {
            const payload = {
                type: "cookie-consent",
                key: "cookieConsentAccepted",
                value,
                sentAt: new Date().toISOString()
            };

            // Change the origin below to match what your iframe expects
            const targetOrigin = window.location.origin;

            console.log("Posting message to iframe:", payload, "origin:", targetOrigin);
            iframe.contentWindow.postMessage(payload, targetOrigin);
        }

        // Simulate initial dispatch and retry
        window.addEventListener("load", () => {
            sendConsent(true);
            setTimeout(() => sendConsent(true), 2000);
        });
    </script>
</body>

</html>